<!doctype html>
<script>
	window.addEventListener("load", function() {
		"use strict";

		function vote(e) {
			var xhr = new XMLHttpRequest();
			xhr.open('post', 'vote/' + this.id, true);
			xhr.send();

			// Mark the selected answer
			var selected = document.querySelectorAll('.selected');
			for (var i = 0; i < selected.length; i++) {
				selected[i].classList.remove('selected');
			}
			this.classList.add('selected');
		}

		function createButtons(n) {
			var c = document.getElementById('container');
			for (var i = 0; i < n; i++) {
				var b = document.createElement('button');
				b.id = i;
				b.innerHTML = String.fromCharCode(i + 65);
				b.classList.add('pure-button');
				c.appendChild(b);
				b.addEventListener('click', vote);
			}
		}

		function build() {
			var xhr = new XMLHttpRequest();
			xhr.open('get', 'num', true);
			xhr.addEventListener('load', function() {
				createButtons(xhr.response);
			});
			xhr.send();

			var socket = io();
			socket.on('ballot_end', function() {
				var buttons = document.querySelectorAll('#container button');
				for (var i = 0; i < buttons.length; i++) {
					buttons[i].setAttribute("disabled", "");
				}
			});
			socket.on('ballot_open', function() {
				var buttons = document.querySelectorAll('#container button');
				for (var i = 0; i < buttons.length; i++) {
					buttons[i].removeAttribute("disabled");
				}
			});
			socket.on('ballot_init', function(data) {
				var buttons = document.querySelectorAll('#container button');
				var c = document.getElementById('container');
				for (var i = 0; i < buttons.length; i++) {
					c.removeChild(buttons[i]);
				}
				createButtons(data);
			});
		}
		build();
	});
</script>
<script src="https://cdn.socket.io/socket.io-1.4.5.js"></script>
<style>
	#container {
		display: flex;
		flex-direction: column;
	}
	
	button {
		flex-grow: 1;
		width: 8em;
		background-color: #2a9ddf;
		border: 0;
		color: white;
		margin: 0.25em auto;
		padding: 0.75em;
		font-weight: bold;
		font-size: 2em;
		border-radius: 0.1em;
	}
	
	button:hover {
		background-color: #f59f00;
	}
	
	button[disabled] {
		background-color: gray;
		color: silver;
	}
	
	button.selected {
		background-color: #f59f00;
	}
	
	button[disabled].selected {
		background-color: #f59f00;
		color: white;
	}
</style>
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>
	ballot
</title>
<div id='container'></div>
